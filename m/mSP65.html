<!DOCTYPE html>
<html lang="en">
    <head>
        
        <!-- Basic Page Needs -->
        <meta charset="utf-8">
            <title>GAP Share of the Population over 80</title>
            <meta name="description" content="">
                <meta name="author" content="">
                    
                    <!-- Mobile Specific Metas -->
                    <meta name="viewport" content="width=device-width, initial-scale=1">
                        
                        <!-- FONT -->
                        <link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">
                            
                            <!-- CSS -->
                            <link rel="stylesheet" href="css/normalize.css">
                                <link rel="stylesheet" href="css/skeleton.css">
                                    <link rel="stylesheet" href="css/m.css">
                                        
                                        <!-- Favicon -->
                                        <link rel="icon" type="image/png" href="images/favicon.png">
                                            
                                            <!-- Leaflet -->
                                            <link rel ="stylesheet" href ="leaflet/leaflet.css" />
                                            <!--[if IE]>
                                             <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
                                             <![endif]-->
                                            <script src="leaflet/leaflet.js"></script>
                                            
                                            <!-- Mapbox -->
                                            <script src="https://api.mapbox.com/mapbox.js/v2.2.3/mapbox.js"> </script>
                                            <link href="https://api.mapbox.com/mapbox.js/v2.2.3/mapbox.css" rel='stylesheet' />
                                            
    </head>
    
    <body>
        
        <!-- Primary Page Layout -->
        <div class= "row">
            <div class= "wrapper">
                <div class= "two columns">
                    <a class="button " href="/Users/Ruth/Desktop/Website/m/mSummary.html">SUMMARY MAP</a>
                </div>
                <div class= "ten columns">
                    <a class="button " href="/Users/Ruth/Desktop/Website/m/mP65.html">P65</a>
                    <a class="button " href="/Users/Ruth/Desktop/Website/m/mP80.html">P80</a>
                    <a class="button " href="/Users/Ruth/Desktop/Website/m/mSR65.html">SR65</a>
                    <a class="button " href="/Users/Ruth/Desktop/Website/m/mSR80.html">SR80</a>
                    <a class="button " href="/Users/Ruth/Desktop/Website/m/mSP65.html">SP65</a>
                    <a class="button " href="/Users/Ruth/Desktop/Website/m/mOCDR.html">OCDR</a>
                </div>
            </div>
        </div>
        
        <div id ='map'></div>
        
        <script src ="js/CDBoundary_simple.js"></script>
        
        <script>
            // Setting up custom mapbox basemap
            
            L.mapbox.accessToken =
            'pk.eyJ1IjoicnV0aGhhbm5haCIsImEiOiJjaWh6MW1sc2MwNDZidWhrb2F3NjkwcmtmIn0.-kBXpXiYaLRbz7Km3UWwEg';
            
            var southWest = L.latLng(30, -145),
            northEast = L.latLng(85, -50),
            bounds = L.latLngBounds(southWest, northEast);
            
            var map= L.mapbox.map('map','ruthhannah.97be37d0',
                                  {maxBounds: bounds,})
                                  .setView([64.696, -100.986], 3);
                                  
                                  
                                  
                                  
                                  function getColor(d){
                                      return d> .35?'#08519c':
                                      d> .17 ?'#3182bd':
                                      d> .10 ?'#6baed6':
                                      d> .06?'#bdd7e7':
                                      '#eff3ff';
                                  }
        
        
        /////////////////////////////////////////////
        function style(feature){
            return {
                fillColor: getColor(feature.properties.S65),
                weight: 0.3,
                opacity: 1,
                color: '#000000',
                dashArray: '',
                fillOpacity:0.7
            };
        }
        
        
        function highlightFeature(e){
            var layer = e.target;
            info.update(layer.feature.properties);
            layer.setStyle({
                           weight:0.7,
                           color: '#000000',
                           dashArray:'',
                           fillOpacity:0
                           });
                           
                           if (!L.Browser.ie && !L.Browser.opera){
                               layer.bringToFront();
                           }
        }
        
        
        function resetHighlight(e) {
            geojson.resetStyle(e.target);
            info.update();
        }
        
        
        var geojson=L.geoJson(CDBoundary_simple,{
                              style:style,
                              onEachFeature: onEachFeature
                              }).addTo(map);
                              
                              
                              
                              function zoomToFeature(e){
                                  map.fitBounds(e.target.getBounds());
                              }
        
        function onEachFeature (feature, layer){
            layer.on({
                     mouseover:highlightFeature,
                     mouseout:resetHighlight,
                     click:zoomToFeature
                     });
        }
        
        //////////////////////////////////////SUMMARY INFO
        // When the mouse hovers the variables attached to each
        // census division are shown in an info box when mouse hovers
        var info = L.control();
        
        info.onAdd = function(map) {
            this._div = L.DomUtil.create('div','info');
            this.update();
            return this._div;
        };
        
        info.update = function(props) {
            this._div.innerHTML = (props? '<b> Province</b>: '+ props.PRNAME : "")
            + (props? '<br/><b>Census Division</b>: '+ props.CDNAME : "")
            + (props? '<br /><b>Share of the Population over 65: </b>' + props.S65.toFixed(2) + '%': "");
        };
        
        info.addTo(map);
        
        
        
        ////////////////////////////////////// LEGEND NOT WORKING!!!
        var legend = L.control({position: 'bottomright'});
        
        legend.onAdd = function (map) {
            
            var div = L.DomUtil.create('div', 'info legend'),
            grades=[0.0,0.06, 0.10, 0.17, 0.35],
            labels=[];
            
            for (var i= 0; i <grades.length; i++){
                div.innerHTML +=
                '<i  style="background:' +getColor(grades[i] +1) + '"></i.>' +
                grades[i] + (grades[i + 1]? '&ndash;' + grades[i + 1] + '<br>' : '+');
            }
            return div;
        };
        
        legend.addTo(map);
        
            </script>
        
        <!-- End Document -->
    </body>
</html>
