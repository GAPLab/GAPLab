<!DOCTYPE html>
<html lang="en">
<head>

<!-- Basic Page Needs -->
    <meta charset="utf-8">
    <title>gap maps</title>
    <meta name="description" content="">
    <meta name="author" content="">

<!-- Mobile Specific Metas -->
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- FONT -->
    <link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">

<!-- CSS -->
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/skeleton.css">
    <link rel="stylesheet" href="css/m.css">

<!-- Favicon -->
    <link rel="icon" type="image/png" href="images/favicon.png">

<!-- Leaflet -->
    <link rel ="stylesheet" href ="leaflet/leaflet.css" />
    <!--[if IE]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <script src="leaflet/leaflet.js"></script>
  
<!-- Mapbox -->
    <script src="https://api.mapbox.com/mapbox.js/v2.2.3/mapbox.js"> </script>
    <link href="https://api.mapbox.com/mapbox.js/v2.2.3/mapbox.css" rel='stylesheet' />

</head>

<body>

<!-- Primary Page Layout -->

<div id ='map'></div>
<script scr ="js/PopulatedPlaces_Canada.js"></script>


<script src ="js/CDBoundary_simple.js"></script>

<script>
    // Setting up custom mapbox basemap
  
    L.mapbox.accessToken =
        'pk.eyJ1IjoicnV0aGhhbm5haCIsImEiOiJjaWh6MW1sc2MwNDZidWhrb2F3NjkwcmtmIn0.-kBXpXiYaLRbz7Km3UWwEg';
    
    var southWest = L.latLng(30, -145),
        northEast = L.latLng(85, -50),
        bounds = L.latLngBounds(southWest, northEast);
    
    var map= L.mapbox.map('map','ruthhannah.97be37d0',
                          {maxBounds: bounds,})
                          .setView([64.696, -100.986], 3);
    
    // Returns a color based on a value
    function getColor(d){
    return d> 69.020?'#54278f':
    d> 63.360 ?'#756bb1':
    d> 59.380?'#9e9ac8':
    d> 55.640?'#cbc9e2':
    '#f2f0f7';
    }

    function style(feature){
    return {
        fillColor: getColor(feature.properties.SR80),
        weight: 0.5,
        opacity: 1,
        color: '#bdbdbd',
        dashArray: '',
        fillOpacity:0.4
        };
    }

    // Highlights census divisions
    function highlightFeature(e){
        var layer = e.target;
        info.update(layer.feature.properties);
        layer.setStyle({
            weight:1,
            color: '#737373',
            dashArray:'',
            fillOpacity:0.8
            });
                   
            if (!L.Browser.ie && !L.Browser.opera){
                layer.bringToFront();
                }
    }

    // Resets the census division highlight
    var geojson;
    
    function resetHighlight(e) {
        geojson.resetStyle(e.target);
        info.update();
    }

    function zoomToFeature(e){
        map.fitBounds(e.target.getBounds());
    }

    // Adds listeners to layer so that census divisions are highlighted and reset
    function onEachFeature (feature, layer){
        layer.on({
             mouseover:highlightFeature,
             mouseout:resetHighlight,
             click:zoomToFeature
             });
    }

    var geojson=L.geoJson(CDBoundary_simple,{
                      style:style,
                      onEachFeature: onEachFeature
                      }).addTo(map);

    // When the mouse hovers the variables attached to each
    // census division are shown in an info box when mouse hovers
    var info = L.control();

    info.onAdd = function(map) {
        this._div = L.DomUtil.create('div','info');
        this.update();
        return this._div;
    };

    info.update = function(props) {
        this._div.innerHTML = (props? '<b> Province</b>: '+ props.PRNAME : "")
        + (props? '<br/><b>Census Division</b>: '+ props.CDNAME : "")
        + (props? '<br /><b>Percent Over 65: </b>' + props.P65.toFixed(2)+ '%' : "")
        + (props? '<br /><b>Percent Over 80: </b>' + props.P80.toFixed(2) + '%' : "")
        + (props? '<br /><b>Sex Ratio 65: </b>' + props.SR65.toFixed(2) + '%' : "")
        + (props? '<br /><b>Sex Ratio 80:</b> ' + props.SR80.toFixed(2) + '%' : "")
        + (props? '<br /><b>Old Component Ratio: </b>' + props.ODR.toFixed(2) + '%': "");
        };

    info.addTo(map);
    
    //Map Legend
    var legend = L.control({position: 'bottomright'});
    
    legend.onAdd = function (map) {
        
        var div = L.DomUtil.create('div', 'info legend'),
        grades=[0,55,59,63,69],
        labels=[];
        
        for (var i= 0; i <grades.length; i++){
            div.innerHTML +=
            '<i  style="background:' +getColor(grades[i] +1) + '"></i.>' +
            grades[i] + (grades[i + 1]? '&ndash;' + grades[i + 1] + '<br>' : '+');
        }
        return div;
    };
    legend.addTo(map);
    
    

</script>



<!-- End Document -->
</body>
</html>
